# Дневник разработки "Optimizator Next Gen"

## Сессия 1: Архитектурное проектирование (23.08.2025)

- Определена миссия, роли (Архитектор/Пользователь, Разработчик/LLM) и стек технологий (Electron, TypeScript).
- Утверждена трехуровневая архитектура: "Оболочка" -> "Оркестратор" -> "Ядро".
- Спроектирована структура `config.json` с тремя корневыми ключами: `themeSettings`, `documentSettings`, `processingSteps`.
- Детализирована структура "атома" (объекта операции) с полями `id`, `name`, `description`, `enabled`, `ui`, `params`.
- Спроектированы первые атомарные функции: `removeStyles`, `setDefaultStyle`, `removeParagraphSpacing`, `removeFirstLineIndentation`, `setPageMargins`.
- После обсуждения принято решение об агрегации функций по удалению отступов, но затем, следуя принципу атомизации, вернулись к раздельным модулям.
- Утверждена гибридная модель для управления стилями: быстрая (замена `styles.xml` из шаблона) и гибкая (генерация `styles.xml` из `config.json`).
- Спроектирован "Режим отладки" (Developer Mode) для удобства тестирования, отображающий все настройки на одном экране.

## Сессия 2: Настройка окружения и первая функция (24.08.2025)

- **Задача:** Настроить рабочее окружение для TypeScript-проекта и создать первую атомарную функцию `removeStyles` с тестами.
- **Действия:**
  1. Инициализирован `npm` в проекте (`package.json`).
  2. Установлены ключевые dev-зависимости: `typescript`, `jest`, `ts-jest`, `@types/jest`.
  3. Созданы и настроены конфигурационные файлы `tsconfig.json` и `jest.config.js`.
  4. **Столкнулись с проблемами:**
     - Предупреждения `EBADENGINE` из-за нестабильной версии Node.js (v23).
     - **Решение:** Установлен `nvm-windows` для управления версиями, выполнен переход на стабильную LTS-версию (v22.18.0).
     - Конфликт `PATH` из-за старой глобальной установки Node.js.
     - **Решение:** Удалена глобальная версия Node.js через "Установку и удаление программ".
     - Визуальные ошибки в VS Code, не связанные с кодом.
     - **Решение:** Диагностирован конфликт версий TypeScript в VS Code, проблема решена выбором "Workspace's Version".
     - Ошибки `Jest` "No tests found".
     - **Решение:** Скорректирован `jest.config.js` для явного указания пути к тестовым файлам.
- **Результат:**
  - Рабочее окружение полностью настроено.
  - Создана первая атомарная функция `removeStyles` и покрыта тремя тестами в `removeStyles.test.ts`.
  - Команда `npm test` успешно выполняется, все тесты проходят.
  - **Вывод:** "Конвейер" для разработки и тестирования готов к работе.

## Этот документ служит для фиксации ключевых архитектурных решений, идей и этапов развития проекта "Optimizator Next Gen".

## Запись #1: Основополагающие принципы

**Дата:** 24.08.2025

**Решение:**

На старте проекта были определены и согласованы следующие ключевые архитектурные и методологические принципы:

1.  **Роли:**

    - **Архитектор (Пользователь):** Стратегия, цели, логика.
    - **Разработчик (LLM):** Техническая реализация, код, экспертиза.

2.  **Методология "Обсуждение → Решение → Код":** Приоритет отдается тщательному обсуждению перед написанием кода. Движемся итеративно, небольшими шагами.

3.  **Архитектура "Единый источник истины":** Файл `config.json` является "схемой" всего приложения, определяя логику обработки, глобальные настройки и даже тему UI.

4.  **Трехуровневая архитектура:**

    - **Уровень "Оболочки":** Работа с файловой системой (`docx`, `fdt`, `xml`).
    - **Уровень "Оркестратора":** Управление конвейером обработки на основе `config.json`.
    - **Уровень "Ядра":** Изолированные, атомарные функции, работающие по принципу `(xmlString) => xmlString`.

5.  **Динамический UI:** Интерфейс генерируется "на лету" на основе метаданных из `config.json`, что обеспечивает максимальную гибкость и расширяемость.

**Обоснование:**

Данный подход выбран для создания максимально гибкого, надежного и легко тестируемого приложения. Он позволяет добавлять новый функционал, минимально затрагивая существующий код, и обеспечивает четкое разделение ответственности между модулями системы.

**Следующие шаги:**

- Создание базовой структуры проекта (папки, `package.json`, `tsconfig.json`).
- Инициализация репозитория на GitHub.
- Проектирование детальной структуры `config.json`.
