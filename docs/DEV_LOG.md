<!-- Файл: docs/DEV_LOG.md -->

# Дневник разработки "Optimizator Next Gen"

### Сессия 6: Решение проблемы вывода markdown и стандартизация форматирования (01.10.2025)

- **Задача:** Устранить проблемы с выводом файлов документации (.md), которые возникали при работе AI-ассистента с PROJECT.md.

- **Проблема:** При выводе файлов .md AI-ассистент разбивал их на несколько блоков кода, что приводило к критическим проблемам:

  1. **Разрушение структуры при копировании:** Файл разваливался на части, между которыми вставлялся отрендеренный markdown
  2. **Схлопывание деревьев файлов:** В VS Code preview дерево структуры проекта (раздел "6. Структура проекта") превращалось в один абзац нечитаемого текста
  3. **Потеря форматирования при сохранении:** VS Code автоматически схлопывал все пробелы в дереве файлов, ломая структуру
  4. **Невозможность надежно копировать документацию:** Каждый вывод требовал ручной правки

  Особенно критично это проявлялось на деревьях структуры проекта — они использовали символы `├─ └─ │` для визуализации иерархии, и любое нарушение отступов делало дерево нечитаемым.

- **Решение:**

  **Этап 1: Попытка использовать один блок кода**

  - Первая попытка: выводить весь .md файл одним блоком `markdown ... `
  - Проблема: AI пытался использовать тройные кавычки ``` внутри блока для дерева структуры, что закрывало внешний блок

  **Этап 2: Использование классического markdown-синтаксиса**

  - Решение: для вложенных блоков кода (деревьев, примеров) использовать **4 пробела в начале каждой строки**
  - Это стандартный markdown-синтаксис для блоков кода, не требующий тройных кавычек
  - Пример:

    ```
    ## 6. Структура проекта

        OptimizatorNG/
        ├─ src/
        │  └─ main.ts
        └─ package.json
    ```

  **Этап 3: Настройка VS Code**

  - Добавлены правила в `.markdownlint.json` для отключения автоматического форматирования:
    ```json
    {
      "MD010": false, // Отключить проверку табуляций
      "MD013": false, // Отключить проверку длины строк
      "MD033": false, // Разрешить HTML
      "MD041": false, // Не требовать заголовок первым
      "whitespace": false // Не трогать пробелы
    }
    ```

  **Этап 4: Фиксация правил в PROMPT.md**

  - Добавлен раздел "Вывод файлов markdown" с жесткими правилами:
    - ВСЕГДА выводить .md файлы ОДНИМ непрерывным блоком
    - НИКОГДА не использовать тройные кавычки внутри блока
    - Использовать 4 пробела для вложенных примеров
    - Закрывать блок без прерываний

- **Ключевые нововведения:**

  1. **Правило 4 пробелов:** Стандартный markdown-синтаксис вместо вложенных тройных кавычек
  2. **Один непрерывный блок:** Гарантия целостности при копировании
  3. **Настройка .markdownlint.json:** Предотвращение автоматического форматирования в VS Code
  4. **Документирование в PROMPT.md:** Правила зафиксированы для всех будущих сессий и AI-ассистентов

- **Технические детали:**

  - Проблема отлаживалась итеративно ~2.5 дня
  - Перепробовано несколько подходов (экранирование, разные синтаксисы)
  - Решение основано на классическом markdown-синтаксисе (4 пробела = code block)
  - Дерево файлов теперь корректно отображается и в редакторе, и в preview

- **Результат:**

  - ✅ PROMPT.md обновлен до версии 2.2.0 с детальными правилами вывода markdown
  - ✅ PROJECT.md обновлен до версии 0.4.0 с правильным деревом структуры (4 пробела)
  - ✅ Добавлены настройки .markdownlint.json для VS Code
  - ✅ Проблема полностью решена и больше не воспроизводится
  - ✅ Документация теперь надежно копируется, сохраняется и отображается

- **Вывод:** Проблема форматирования документации решена на архитектурном уровне. Правила зафиксированы в PROMPT.md и будут применяться во всех будущих проектах. Система документации теперь не только логически структурирована (Сессия 5), но и технически надежна.

---

### Сессия 5: Структурирование документации и промптов (01.10.2025)

- **Задача:** Создать систему документации, которая разделяет универсальные правила работы с LLM и специфику конкретного проекта, обеспечивая переиспользование в будущих проектах.

- **Проблема:** Существующий промпт содержал смесь общих правил взаимодействия и специфичных для проекта деталей. Это затрудняло:

  - Переиспользование правил в других проектах
  - Быструю навигацию по документации
  - Восстановление контекста при работе с разными моделями

- **Решение:** Документация была разделена на два независимых файла:

  **PROMPT.md (универсальный промпт):**

  - Философия взаимодействия (диалог, обучение, критика)
  - Роли участников (Архитектор/Пользователь, Технический консультант/LLM)
  - **Манера общения (критично):**
    - Запрет на извинения (фокус на решении, а не на формальностях)
    - Перепроверка кода перед отправкой
    - Требование задавать вопросы вместо угадывания
  - Формат работы с кодом (целые файлы, имя файла в начале)
  - **Единообразие стиля проектов:**
    - Стандартная структура документации
    - Правила оформления Markdown
    - Структура кода (шапки файлов, порядок элементов, именование)
    - Комментарии (JSDoc, префиксы WHY/ASSUME/TODO/FIXME)
    - Git-практики (Conventional Commits)
    - Конфигурационные файлы
  - Когда останавливаться и задавать вопросы
  - Обработка ошибок
  - Тестирование
  - **Контрольный чеклист** перед ответом

  **PROJECT.md (специфика проекта):**

  - Миссия проекта Optimizator Next Gen
  - Стек технологий (Electron, TypeScript, Jest)
  - Архитектурные принципы (единый источник истины, трёхуровневая архитектура)
  - Структура config.json
  - Технические регламенты (IPC-протокол, безопасность, логирование)
  - Структура проекта
  - Специфичные требования к коду (шаблоны для Core/Orchestrator/Shell)
  - Контекст для восстановления (текущие задачи, нерешённые вопросы)
  - Журнал изменений PROJECT.md

- **Ключевые нововведения:**

  1. **Запрет на извинения:** LLM больше не тратит время на формальности, сразу даёт исправленный код или решение.
  2. **Имя файла в начале:** Каждый файл начинается с комментария `// Файл: ...` или `<!-- Файл: ... -->`, чтобы устранить путаницу при работе с несколькими файлами.
  3. **Craft не используется:** Весь код передаётся обычными code-блоками Markdown.
  4. **Единообразие стиля:** Чёткие требования к структуре файлов, именованию, комментариям и git-коммитам.
  5. **Контрольный чеклист:** LLM проверяет 7 пунктов перед каждым ответом с кодом.

- **Технические детали:**

  - Оба файла используют версионирование (PROMPT.md v1.0.0, PROJECT.md v0.3.0)
  - PROJECT.md содержит ссылку на базовый PROMPT.md
  - Раздел "Контекст для восстановления" помогает переносу информации между сессиями и моделями
  - Журналы изменений позволяют отслеживать эволюцию правил

- **Результат:**

  - Создана масштабируемая система документации
  - PROMPT.md стал универсальным для любых проектов
  - PROJECT.md содержит уникальную информацию о проекте
  - Манера общения LLM стала эффективнее (без извинений, с уточняющими вопросами)
  - Установлены единые стандарты кода для будущих проектов

- **Вывод:** Документация переведена на новый уровень; структура облегчает работу сейчас и закладывает фундамент для нового качества всех будущих проектов.

---

### Сессия 4: Битва за UI и переход на esbuild (25.08.2025)

- **Задача:** Отобразить в окне Electron динамический список шагов обработки из `config.json`.

- **Проблема:** Интерфейс зависал на стадии "Загрузка...". После длительной отладки выявлен коренной конфликт между CommonJS и ESM.
- **Решение:** В проект добавлен esbuild как сборщик фронтенда; `tsc` компилирует только бэкенд.
- **Результат:** Приложение строится и работает стабильно, интерфейс строится на лету, сборка поднята на промышленный уровень.
- **Вывод:** Архитектурная ошибка устраняется не в коде, а в процессе сборки.

---

### Сессия 3: Создание "Оболочки" — Фронтенд разработчика (25.08.2025)

- **Задача:** Интегрировать GUI на Electron, чтобы заменить консоль и визуализировать процесс.
- **Действия:** Создан main.ts, реализован preload.ts, настроена IPC, сделан динамический фронтенд на renderer.ts и index.html.
- **Проблемы и их решения:** Проблемы с типами, маршрутизацией IPC решены через интерфейсы и рефакторинг, UI теперь строится на лету из config.json.
- **Результат:** Получен рабочий графический интерфейс, лог показывается в реальном времени, система готова к расширению.
- **Вывод:** Переход от консоли к полноценному десктопу состоялся.

---

### Сессия 2: Настройка окружения и первая функция (24.08.2025)

- **Задача:** Настроить TypeScript, Jest, создать первую атомарную функцию `removeStyles`.
- **Действия:** Поднят npm-проект, поставлены ts-jest, typescript, отлажены версии Node через nvm и PATH.
- **Проблемы:** Конфликты tsconfig и jest.config, устранялись через явные пути, версиями исправили баги VS Code.
- **Результат:** Первая функция и тесты работают, тесты проходят, "конвейер" разработки запущен.
- **Вывод:** Базовое окружение полностью готово.

---

### Сессия 1: Архитектурное проектирование (23.08.2025)

- Определена миссия, стек технологий, трёхуровневая архитектура, структура config.json и атомов.
- Приняты первые решения по атомизации функций, агрегации/разделения по назначению.
- Спроектирована гибридная система для управления стилями и "Режим разработчика" с отображением всех настроек на экране.

---
